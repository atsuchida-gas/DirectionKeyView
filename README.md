# DirectionKeyView

仕様

・Rasberry PiのGPIO情報をGASで公開する

・非同期通信にてGPIO情報を自動リフレッシュする


ファイル構成

・code.gs

　　∟GAS起動時に実行されるファイル。基本的にJS表記。
  
・index.html

　　∟アクセスがあった際に表示されるhtmlファイル。
  
・main.html

　　∟html内でのJS処理を記載。
  
・CSS.html

　　∟CSSを記載。（今回は未使用）
  
  
  
　まず、本来一番楽に実装できる方法として考えたのが

・JSで直接GPIO情報を読み取り→WEB上で公開する

ただJSでGPIO情報を読むためのモジュールがNode.jsにしかなく

GASでNode.jsを使えないことから上記方法が使えない


　次に考えたのが

・ラズパイ上PythonでGPIO情報取得→doPostでGASにJSON形式で渡す→WEB上で公開する

こちらはラズパイ上Pythonファイルがローカル上でしか起動させられたい為却下


　次案、

・ラズパイ上PythonでGPIO情報取得→doGetでGASにJSON形式で渡す→WEB上で公開する

こちらはGASの仕様上code.gs内のデータを抜けない為却下


　次案、

・Pythonでスプレッドシートに書き込み→GASでスプレッドシート情報取得→WEB上で公開する

かなり遠回りな方法な上に経由するサービスが多くなるのでできるだけ避けたかったが

これ以外に方法が思いつかなかった為、これで実装することに



　本来はスプレッドシート側からWebsocketを叩き自動更新したかったが

スプレッドシートでは使えないことがわかった為、かなり不細工な方法(setInterval)にて実装する

アプリケーション側からこの方法で行うとアクセスがうまくいかなかった場合挙動や処理がおかしくなるので

本来はデータベース側から更新を実行するのが絶対にいいです。

なのでかなり特殊で限られた環境以外では基本的にこのやり方をしない方がいいです。



　まずデータを取得し、AJAX通信で割り当て、setIntervalで自動リフレッシュする

という順番で実現しています。

これらを応用すると、例えば温度などの数値データを取得し、タイムスタンプと共にスプレッドシートを更新し、

作成したグラフを更新し、そのグラフを自動更新でサイト上に表示させる

などのことも実装できると思います。
